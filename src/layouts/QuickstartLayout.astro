---
import BaseLayout from './BaseLayout.astro';
import TableOfContents from '@components/TableOfContents.astro';
import ContributorList from '@components/ContributorList.astro';
import VariantSwitcher from '@components/VariantSwitcher.astro';
import { getCanonicalUrl, getOgImageUrl } from '@utils/seo';
import { generateQuickstartSchemas } from '@utils/schema';

interface Props {
  title: string;
  description: string;
  variant: string;
  category: string;
  id: string;
  availableVariants: string[];
  headings: { depth: number; slug: string; text: string }[];
  filePath: string;
}

const {
  title,
  description,
  variant,
  category,
  id,
  availableVariants,
  headings,
  filePath,
} = Astro.props;

const canonicalUrl = getCanonicalUrl(id, variant);
const ogImageUrl = getOgImageUrl(id, variant);
const schemas = generateQuickstartSchemas({
  title,
  description,
  url: canonicalUrl,
  category,
  ogImage: ogImageUrl,
});
---

<BaseLayout
  title={title}
  description={description}
  id={id}
  canonicalUrl={canonicalUrl}
  ogImage={ogImageUrl}
  ogType="article"
  category={category}
  schemas={schemas}
>
  <article class="quickstart container">
    <header class="quickstart-header">
      <div class="quickstart-meta">
        <span class="tag">{category}</span>
        <VariantSwitcher
          currentVariant={variant}
          availableVariants={availableVariants}
          currentId={id}
        />
      </div>
      <h1>{title}</h1>
      <p class="quickstart-description">{description}</p>
    </header>

    <div class="quickstart-content-wrapper">
      <aside class="quickstart-sidebar">
        <TableOfContents headings={headings} />
      </aside>

      <div class="quickstart-content content">
        <slot />

        <footer class="quickstart-footer">
          <ContributorList filePath={filePath} />
        </footer>
      </div>
    </div>
  </article>
</BaseLayout>

<style>
  .quickstart {
    padding: 2rem 1rem;
  }

  .quickstart-header {
    margin-bottom: 2rem;
  }

  .quickstart-meta {
    display: flex;
    align-items: center;
    gap: 1rem;
    margin-bottom: 1rem;
  }

  .quickstart-description {
    color: var(--color-text-secondary);
    font-size: 1.125rem;
    margin: 0;
  }

  .quickstart-content-wrapper {
    display: grid;
    grid-template-columns: 1fr;
    gap: 2rem;
  }

  @media (min-width: 1024px) {
    .quickstart-content-wrapper {
      grid-template-columns: 1fr 16rem;
    }

    .quickstart-sidebar {
      order: 1;
      position: sticky;
      top: 2rem;
      align-self: start;
    }

    .quickstart-content {
      order: 0;
    }
  }

  .quickstart-footer {
    margin-top: 3rem;
    padding-top: 2rem;
    border-top: 1px solid var(--color-border);
  }

  @media (max-width: 640px) {
    .quickstart {
      padding: 1.5rem 0.75rem;
    }

    .quickstart-header {
      margin-bottom: 1.5rem;
    }

    .quickstart-meta {
      flex-wrap: wrap;
      gap: 0.75rem;
    }

    .quickstart-description {
      font-size: 1rem;
    }

    .quickstart-content-wrapper {
      gap: 1.5rem;
    }

    .quickstart-footer {
      margin-top: 2rem;
      padding-top: 1.5rem;
    }
  }
</style>
