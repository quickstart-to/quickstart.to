---
import QuickstartLayout from '@layouts/QuickstartLayout.astro';
import {
  getAllQuickstarts,
  getQuickstartByIdWithFallback,
  getAvailableLanguages,
} from '@utils/content';
import { defaultLang } from '@i18n/config';

export async function getStaticPaths() {
  const quickstarts = await getAllQuickstarts();
  const uniqueIds = [...new Set(quickstarts.map((q) => q.id))];

  return uniqueIds.map((id) => ({
    params: { id },
  }));
}

const { id } = Astro.params;

if (!id) {
  return Astro.redirect('/404');
}

const lang = defaultLang;
const quickstart = await getQuickstartByIdWithFallback(id, lang);

if (!quickstart) {
  return Astro.redirect('/404');
}

const availableLanguages = await getAvailableLanguages(id);
const { Content, headings } = await quickstart.entry.render();

// Construct file path for contributors
const filePath = `src/content/${quickstart.category}/${id}/${quickstart.lang}.md`;
---

<QuickstartLayout
  title={quickstart.entry.data.title}
  description={quickstart.entry.data.description}
  lang={quickstart.lang}
  category={quickstart.category}
  id={id}
  availableLanguages={availableLanguages}
  headings={headings}
  filePath={filePath}
>
  <Content />
</QuickstartLayout>
