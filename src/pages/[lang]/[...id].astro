---
import QuickstartLayout from '@layouts/QuickstartLayout.astro';
import {
  getAllQuickstarts,
  getQuickstartById,
  getAvailableLanguages,
} from '@utils/content';
import { supportedLangs, isValidLang, type Lang } from '@i18n/config';

export async function getStaticPaths() {
  const quickstarts = await getAllQuickstarts();
  const paths: { params: { lang: string; id: string } }[] = [];

  for (const q of quickstarts) {
    paths.push({
      params: { lang: q.lang, id: q.id },
    });
  }

  return paths;
}

const { lang, id } = Astro.params;

if (!lang || !id || !isValidLang(lang)) {
  return Astro.redirect('/404');
}

const quickstart = await getQuickstartById(id, lang as Lang);

if (!quickstart) {
  return Astro.redirect('/404');
}

const availableLanguages = await getAvailableLanguages(id);
const { Content, headings } = await quickstart.entry.render();

// Construct file path for contributors
const filePath = `src/content/${quickstart.category}/${id}/${lang}.md`;
---

<QuickstartLayout
  title={quickstart.entry.data.title}
  description={quickstart.entry.data.description}
  lang={lang as Lang}
  category={quickstart.category}
  id={id}
  availableLanguages={availableLanguages}
  headings={headings}
  filePath={filePath}
>
  <Content />
</QuickstartLayout>
